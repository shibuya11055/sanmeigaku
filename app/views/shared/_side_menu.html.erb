<div class="side-menu" id="sideMenu">
  <div class="side-menu-header">
    <div class="app-logo">
      <i class="fas fa-dharmachakra"></i>
      <span class="app-name">算命学アプリ</span>
    </div>
    <button id="closeSideMenuBtn" class="close-menu-btn">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="side-menu-user">
    <div class="user-avatar">
      <i class="fas fa-user-circle"></i>
    </div>
    <div class="user-info">
      <div class="user-name"><%= current_user.fullname %></div>
      <div class="user-role">ログインユーザー</div>
    </div>
  </div>

  <nav class="side-menu-nav">
    <ul class="side-menu-items">
      <li class="side-menu-item <%= current_page?(clients_path) ? 'active' : '' %>">
        <%= link_to clients_path do %>
          <i class="fas fa-users"></i>
          <span class="menu-text">顧客管理</span>
        <% end %>
      </li>
      <li class="side-menu-item <%= current_page?('/fortune_analysis') ? 'active' : '' %>">
        <%= link_to '/fortune_analysis' do %>
          <i class="fas fa-chart-line"></i>
          <span class="menu-text">宿命図</span>
        <% end %>
      </li>
    </ul>
  </nav>

  <div class="side-menu-footer">
    <%= button_to destroy_user_session_path, method: :delete, class: "logout-btn", form: { data: { turbo_confirm: "ログアウトしますか？" } } do %>
      <i class="fas fa-sign-out-alt"></i>
      <span>ログアウト</span>
    <% end %>
  </div>
</div>

<!-- モバイル用メニュートグルボタン -->
<div class="mobile-menu-toggle" id="openSideMenuBtn">
  <i class="fas fa-bars"></i>
</div>

<!-- オーバーレイ背景 -->
<div class="side-menu-overlay" id="sideMenuOverlay"></div>

<script>
  // サイドメニューの表示・非表示を管理するスクリプト
  document.addEventListener('DOMContentLoaded', function() {
    initSideMenu();
  });

  document.addEventListener('turbo:load', function() {
    initSideMenu();
  });

  function initSideMenu() {
    const sideMenu = document.getElementById('sideMenu');
    const openSideMenuBtn = document.getElementById('openSideMenuBtn');
    const closeSideMenuBtn = document.getElementById('closeSideMenuBtn');
    const sideMenuOverlay = document.getElementById('sideMenuOverlay');

    // メニューを開く
    if (openSideMenuBtn) {
      openSideMenuBtn.addEventListener('click', function() {
        console.log('開くボタンがクリックされました');
        sideMenu.classList.add('show');
        sideMenuOverlay.classList.add('show');
        document.body.style.overflow = 'hidden'; // スクロール防止
      });
    }

    // メニューを閉じる
    if (closeSideMenuBtn) {
      closeSideMenuBtn.addEventListener('click', function() {
        console.log('閉じるボタンがクリックされました');
        closeSideMenu();
      });
    }

    // オーバーレイクリックでもメニューを閉じる
    if (sideMenuOverlay) {
      sideMenuOverlay.addEventListener('click', function() {
        closeSideMenu();
      });
    }

    // 画面サイズが変わった時の対応
    window.addEventListener('resize', function() {
      if (window.innerWidth > 768) {
        // デスクトップサイズになったらメニューを表示
        if (sideMenu) sideMenu.classList.remove('show');
        if (sideMenuOverlay) sideMenuOverlay.classList.remove('show');
        document.body.style.overflow = '';
      }
    });

    // メニューを閉じる共通関数
    function closeSideMenu() {
      if (sideMenu) sideMenu.classList.remove('show');
      if (sideMenuOverlay) sideMenuOverlay.classList.remove('show');
      document.body.style.overflow = ''; // スクロール復活
    }
  }
</script>
